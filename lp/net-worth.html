<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5SF9L94K');</script>
  <!-- End Google Tag Manager -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Free Net Worth Calculator - Track Your Wealth in 60 Seconds | SaveBest.org</title>
  <style>
    body { font-family: 'Helvetica Neue', sans-serif; background-color: #ffffff; margin: 0; padding: 0; color: #333; }
    .wizard-container { max-width: 480px; margin: 0 auto; padding: 2rem 1rem; background-color: #ffffff; text-align: center; }
    .logo img { max-width: 220px; height: auto; margin-bottom: 1.5rem; }
    .progress-bar { background-color: #e6e6e6; border-radius: 5px; overflow: hidden; height: 6px; margin-bottom: 1rem; }
    .progress-fill { background-color: #3f6b5d; width: 33.333%; height: 100%; transition: width 0.3s ease; }
    .progress-label { text-align: center; font-size: 0.9rem; color: #3f6b5d; margin-bottom: 1rem; height: 0; overflow: hidden; }
    .question { font-size: 1.4rem; font-weight: bold; margin-bottom: 0.5rem; color: #333; }
    .subtext { font-size: 0.95rem; color: #666; margin-bottom: 1.25rem; }
    .grid-buttons { display: flex; flex-direction: column; gap: 0.75rem; }
    .option-button, .submit-button { padding: 1rem; font-size: 1rem; background-color: #f5f5f5; color: #333; border: 2px solid #ddd; border-radius: 30px; cursor: pointer; font-weight: bold; transition: background-color 0.2s, border-color 0.2s; }
    .option-button:hover, .submit-button:hover { background-color: #e0e0e0; border-color: #3f6b5d; }
    .top-bar { display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem; margin-bottom: 1rem; }
    .nav-links { display: flex; gap: 1rem; }
    .nav-links a { color: #888; text-decoration: none; cursor: pointer; }
    .hidden { display: none; }
    .email-input { padding: 0.8rem; font-size: 1rem; border-radius: 8px; border: 1px solid #ccc; margin-bottom: 1rem; width: 100%; }
    .fine-print { font-size: 0.75rem; color: #888; margin-top: 2rem; padding: 1rem; background-color: #f8f8f8; border-radius: 8px; line-height: 1.4; }
    .benefit-text { font-size: 0.9rem; color: #3f6b5d; font-weight: 500; margin-bottom: 1rem; }
    .urgency-text { font-size: 0.85rem; color: #d32f2f; font-weight: 500; margin-bottom: 1rem; }
    .help-tooltip { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border: 1px solid #ddd; border-radius: 8px; padding: 1.5rem; box-shadow: 0 4px 20px rgba(0,0,0,0.15); z-index: 1000; max-width: 400px; width: 90%; max-height: 80vh; overflow-y: auto; display: none; }
    .help-tooltip h3 { margin: 0 0 1rem 0; color: #3f6b5d; font-size: 1.1rem; }
    .help-tooltip p { margin: 0 0 1rem 0; line-height: 1.5; color: #555; }
    .help-tooltip .close-btn { position: absolute; top: 0.5rem; right: 0.5rem; background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #999; padding: 0.25rem; min-width: 2rem; min-height: 2rem; display: flex; align-items: center; justify-content: center; }
    .help-tooltip .close-btn:hover { color: #333; }
    .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; display: none; }
    
    /* Mobile-specific styles for tooltips */
    @media (max-width: 768px) {
      .help-tooltip { 
        width: 95%; 
        max-width: none; 
        padding: 1.25rem; 
        margin: 1rem; 
        top: 50%; 
        left: 50%; 
        transform: translate(-50%, -50%);
        max-height: 85vh;
      }
      .help-tooltip h3 { font-size: 1rem; }
      .help-tooltip p { font-size: 0.9rem; }
      .help-tooltip .close-btn { 
        top: 0.75rem; 
        right: 0.75rem; 
        font-size: 1.25rem; 
        min-width: 2.5rem; 
        min-height: 2.5rem; 
      }
    }
    
    @media (max-width: 480px) {
      .help-tooltip { 
        width: 98%; 
        padding: 1rem; 
        margin: 0.5rem; 
      }
      .help-tooltip h3 { font-size: 0.95rem; }
      .help-tooltip p { font-size: 0.85rem; }
    }
    
    /* Exit modal button styles */
    .exit-modal-buttons { 
      display: flex; 
      gap: 1rem; 
      margin-top: 1.5rem; 
      flex-direction: row; 
    }
    .exit-btn-secondary { 
      flex: 1; 
      background-color: #f5f5f5; 
      border: 2px solid #ddd; 
    }
    .exit-btn-primary { 
      flex: 1; 
      background-color: #3f6b5d; 
      color: white; 
      border: 2px solid #3f6b5d; 
    }
    
    /* Mobile styles for exit modal buttons */
    @media (max-width: 480px) {
      .exit-modal-buttons { 
        flex-direction: column; 
        gap: 0.75rem; 
      }
      .exit-btn-secondary, .exit-btn-primary { 
        padding: 1rem 0.75rem; 
        font-size: 0.95rem; 
      }
    }

    /* Slider styles */
    .slider-container {
      margin: 2rem 0;
      text-align: center;
    }
    
    .slider {
      width: 100%;
      height: 8px;
      border-radius: 4px;
      background: #e6e6e6;
      outline: none;
      -webkit-appearance: none;
      margin-bottom: 1rem;
    }
    
    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: #3f6b5d;
      cursor: pointer;
    }
    
    .slider::-moz-range-thumb {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: #3f6b5d;
      cursor: pointer;
      border: none;
    }
    
    .slider-value {
      font-size: 1.5rem;
      font-weight: bold;
      color: #3f6b5d;
      margin-bottom: 1.5rem;
    }
    
    .running-tally {
      background: #f8f8f8;
      border-radius: 8px;
      padding: 1.5rem;
      margin: 1.5rem 0;
      text-align: left;
    }
    
    .tally-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
      font-size: 1rem;
    }
    
    .tally-item.total {
      font-weight: bold;
      font-size: 1.1rem;
      color: #3f6b5d;
      border-top: 1px solid #ddd;
      padding-top: 0.5rem;
      margin-top: 0.5rem;
    }
    
    .final-results {
      background: #f8f8f8;
      border-radius: 8px;
      padding: 2rem;
      margin: 1.5rem 0;
    }
    
    .result-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #ddd;
    }
    
    .result-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    
    .result-item.total {
      font-weight: bold;
      font-size: 1.2rem;
      color: #3f6b5d;
      border-top: 2px solid #3f6b5d;
      padding-top: 1rem;
      margin-top: 1rem;
    }
    
    .result-label {
      font-size: 1rem;
      color: #666;
    }
    
    .result-value {
      font-size: 1.2rem;
      font-weight: bold;
      color: #333;
    }
    
    .result-item.total .result-value {
      color: #3f6b5d;
      font-size: 1.4rem;
    }
  </style>
</head>
<body>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5SF9L94K"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<div class="wizard-container">
  <div class="logo"><img src="/assets/logo.png" alt="SaveBest.org Logo"></div>

  <div class="top-bar">
    <div class="progress-label" id="progress-text"></div>
    <div class="nav-links">
      <a onclick="goPrev()" id="previous-link" class="hidden">Previous</a>
      <a onclick="showHelp()" style="cursor: pointer;">Help</a>
      <a onclick="showExitConfirm()" style="cursor: pointer;">Exit</a>
    </div>
  </div>

  <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>

  <div id="step-1" class="step">
    <div class="question">Let's calculate your net worth. Would you like to use an automated mode or calculate manually?</div>
    <div class="subtext">Automated mode connects your accounts and tracks your net worth accurately over time. Manual mode lets you input your assets and liabilities step by step.</div>
    <div class="grid-buttons">
      <button class="option-button" onclick="selectCalculationMode('automated')">Calculate Automatically</button>
      <button class="option-button" onclick="selectCalculationMode('manual')">Calculate Manually</button>
    </div>
  </div>

  <div id="step-2" class="step hidden">
    <div class="question">What's your current liquid net worth?</div>
    <div class="subtext">Estimate your current liquid net worth (a guess is fine). Liquid means cash, savings, investments, and retirement accounts.</div>
    <div class="grid-buttons">
      <button class="option-button" onclick="selectAssets('<$10k')">&lt;$10k</button>
      <button class="option-button" onclick="selectAssets('$10k–$50k')">$10k–$50k</button>
      <button class="option-button" onclick="selectAssets('$50k–$100k')">$50k–$100k</button>
      <button class="option-button" onclick="selectAssets('$100k–$500k')">$100k–$500k</button>
      <button class="option-button" onclick="selectAssets('$500k–$1m')">$500k–$1m</button>
      <button class="option-button" onclick="selectAssets('$1m+')">$1m+</button>
    </div>
  </div>

  <div id="step-3" class="step hidden">
    <div class="logo"><img src="/assets/empower-logo.svg" alt="Empower Logo"></div>
    <div class="question" id="empower-recommendation">Continue to Track Net Worth Automatically</div>
    <div class="subtext" id="empower-subtext">Here's how you track net worth automatically - just connect a few accounts and you're good to get a full financial picture. Based on your ${assetRange} net worth, we recommend Empower's free net worth tracker.</div>
    <div class="benefit-text">✓ Free forever • Syncs all accounts • Professional-grade insights</div>
    <div class="grid-buttons"><button class="option-button" onclick="redirectToEmpower()">Get Started Free →</button></div>
    <div class="fine-print">
      <strong>Disclosure:</strong> We are compensated for business referred to most of the companies we mention.
    </div>
  </div>

  <div id="step-3-monarch" class="step hidden">
    <div class="logo"><img src="/assets/MonarchLogo.PNG" alt="Monarch Money Logo"></div>
    <div class="question" id="monarch-recommendation">Continue to Track Net Worth Automatically</div>
    <div class="subtext" id="monarch-subtext">Here's how you track net worth automatically - just connect a few accounts and you're good to get a full financial picture. Based on your ${assetRange} net worth, we recommend Monarch Money's comprehensive financial management platform.</div>
    <div class="benefit-text">✓ All-in-one financial management • Beautiful interface • Expert insights</div>
    <div class="grid-buttons"><button class="option-button" onclick="redirectToMonarch()">Get Started →</button></div>
    <div class="fine-print">
      <strong>Disclosure:</strong> We are compensated for business referred to most of the companies we mention.
    </div>
  </div>

  <div id="step-3-pocketsmith" class="step hidden">
    <div class="logo"><img src="/assets/pocketsmith-logo.svg" alt="Pocketsmith Logo"></div>
    <div class="question" id="pocketsmith-recommendation">Continue to Track Net Worth Automatically</div>
    <div class="subtext" id="pocketsmith-subtext">Here's how you track net worth automatically - just connect a few accounts and you're good to get a full financial picture. Based on your ${assetRange} net worth, we recommend Pocketsmith's powerful financial forecasting platform.</div>
    <div class="benefit-text">✓ Advanced forecasting • Cash flow planning • Goal tracking</div>
    <div class="grid-buttons"><button class="option-button" onclick="redirectToPocketsmith()">Get Started →</button></div>
    <div class="fine-print">
      <strong>Disclosure:</strong> We are compensated for business referred to most of the companies we mention.
    </div>
  </div>

  <div id="step-4" class="step hidden">
    <div class="question">Get Your Personalized Financial Roadmap</div>
    <div class="subtext" id="step4-subtext">We'll send you custom strategies to grow your net worth faster, plus exclusive access to our best money-saving tools.</div>
    <div class="benefit-text">✓ Weekly wealth-building tips • Exclusive tool access • No spam, unsubscribe anytime</div>
    <input type="email" placeholder="Enter your email address" class="email-input">
    <div class="grid-buttons"><button class="submit-button" onclick="submitEmail()">Get My Free Roadmap →</button></div>
  </div>

  <!-- Manual Calculation Steps -->
  <div id="step-manual-cash" class="step hidden">
    <div class="question">How much cash do you have?</div>
    <div class="subtext">Include checking accounts, savings accounts, and physical cash.</div>
    <div class="slider-container">
      <input type="range" id="cash-slider" min="0" max="1000000" step="1000" value="0" class="slider">
      <div class="slider-value">$<span id="cash-value">0</span></div>
    </div>
    <div class="running-tally">
      <div class="tally-item">Assets: $<span id="total-assets">0</span></div>
      <div class="tally-item">Liabilities: $<span id="total-liabilities">0</span></div>
      <div class="tally-item total">Net Worth: $<span id="net-worth-total">0</span></div>
    </div>
    <div class="grid-buttons"><button class="submit-button" onclick="nextManualStep('cash')">Next →</button></div>
  </div>

  <div id="step-manual-investments" class="step hidden">
    <div class="question">What's the value of your investments?</div>
    <div class="subtext">Include retirement accounts (401k, IRA), brokerage accounts, and other investments.</div>
    <div class="slider-container">
      <input type="range" id="investments-slider" min="0" max="5000000" step="10000" value="0" class="slider">
      <div class="slider-value">$<span id="investments-value">0</span></div>
    </div>
    <div class="running-tally">
      <div class="tally-item">Assets: $<span id="total-assets">0</span></div>
      <div class="tally-item">Liabilities: $<span id="total-liabilities">0</span></div>
      <div class="tally-item total">Net Worth: $<span id="net-worth-total">0</span></div>
    </div>
    <div class="grid-buttons"><button class="submit-button" onclick="nextManualStep('investments')">Next →</button></div>
  </div>

  <div id="step-manual-real-estate" class="step hidden">
    <div class="question">What's the value of your real estate?</div>
    <div class="subtext">Include your home, rental properties, and other real estate assets.</div>
    <div class="slider-container">
      <input type="range" id="real-estate-slider" min="0" max="10000000" step="50000" value="0" class="slider">
      <div class="slider-value">$<span id="real-estate-value">0</span></div>
    </div>
    <div class="running-tally">
      <div class="tally-item">Assets: $<span id="total-assets">0</span></div>
      <div class="tally-item">Liabilities: $<span id="total-liabilities">0</span></div>
      <div class="tally-item total">Net Worth: $<span id="net-worth-total">0</span></div>
    </div>
    <div class="grid-buttons"><button class="submit-button" onclick="nextManualStep('real-estate')">Next →</button></div>
  </div>

  <div id="step-manual-other-assets" class="step hidden">
    <div class="question">What's the value of your other assets?</div>
    <div class="subtext">Include vehicles, jewelry, collectibles, business interests, and other valuable items.</div>
    <div class="slider-container">
      <input type="range" id="other-assets-slider" min="0" max="2000000" step="10000" value="0" class="slider">
      <div class="slider-value">$<span id="other-assets-value">0</span></div>
    </div>
    <div class="running-tally">
      <div class="tally-item">Assets: $<span id="total-assets">0</span></div>
      <div class="tally-item">Liabilities: $<span id="total-liabilities">0</span></div>
      <div class="tally-item total">Net Worth: $<span id="net-worth-total">0</span></div>
    </div>
    <div class="grid-buttons"><button class="submit-button" onclick="nextManualStep('other-assets')">Next →</button></div>
  </div>

  <div id="step-manual-mortgage" class="step hidden">
    <div class="question">How much do you owe on your mortgage(s)?</div>
    <div class="subtext">Include all mortgage balances on your properties.</div>
    <div class="slider-container">
      <input type="range" id="mortgage-slider" min="0" max="5000000" step="10000" value="0" class="slider">
      <div class="slider-value">$<span id="mortgage-value">0</span></div>
    </div>
    <div class="running-tally">
      <div class="tally-item">Assets: $<span id="total-assets">0</span></div>
      <div class="tally-item">Liabilities: $<span id="total-liabilities">0</span></div>
      <div class="tally-item total">Net Worth: $<span id="net-worth-total">0</span></div>
    </div>
    <div class="grid-buttons"><button class="submit-button" onclick="nextManualStep('mortgage')">Next →</button></div>
  </div>

  <div id="step-manual-other-debt" class="step hidden">
    <div class="question">How much other debt do you have?</div>
    <div class="subtext">Include credit cards, car loans, student loans, personal loans, and other debts.</div>
    <div class="slider-container">
      <input type="range" id="other-debt-slider" min="0" max="1000000" step="1000" value="0" class="slider">
      <div class="slider-value">$<span id="other-debt-value">0</span></div>
    </div>
    <div class="running-tally">
      <div class="tally-item">Assets: $<span id="total-assets">0</span></div>
      <div class="tally-item">Liabilities: $<span id="total-liabilities">0</span></div>
      <div class="tally-item total">Net Worth: $<span id="net-worth-total">0</span></div>
    </div>
    <div class="grid-buttons"><button class="submit-button" onclick="nextManualStep('other-debt')">Next →</button></div>
  </div>

  <div id="step-manual-results" class="step hidden">
    <div class="question">Your Net Worth Calculation</div>
    <div class="subtext">Here's your complete financial picture based on your inputs.</div>
    <div class="final-results">
      <div class="result-item">
        <div class="result-label">Total Assets</div>
        <div class="result-value" id="final-assets">$0</div>
      </div>
      <div class="result-item">
        <div class="result-label">Total Liabilities</div>
        <div class="result-value" id="final-liabilities">$0</div>
      </div>
      <div class="result-item total">
        <div class="result-label">Net Worth</div>
        <div class="result-value" id="final-net-worth">$0</div>
      </div>
    </div>
    <div class="logo" id="manual-recommendation-logo">
      <img src="" alt="Recommended Platform" style="max-width: 180px; height: auto; margin: 1.5rem 0;">
    </div>
    <div class="grid-buttons" id="manual-recommendation-buttons">
      <button class="submit-button" id="manual-recommendation-button" onclick="redirectFromManualResults()">Track Net Worth Automatically w/ Empower</button>
    </div>
    <div class="fine-print" id="manual-disclaimer">
      <strong>Disclosure:</strong> We are compensated for business referred to most of the companies we mention.
    </div>
  </div>


</div>

<!-- Help Tooltip Overlay -->
<div class="overlay" id="overlay"></div>

<!-- Help Tooltip -->
<div class="help-tooltip" id="help-tooltip">
  <button class="close-btn" onclick="closeHelp()">&times;</button>
  <h3 id="help-title">Why are we asking this?</h3>
  <p id="help-content">Help content will appear here.</p>
</div>

<!-- Exit Confirmation Modal -->
<div class="help-tooltip" id="exit-confirm-modal">
  <button class="close-btn" onclick="closeExitConfirm()">&times;</button>
  <h3>Are you sure?</h3>
  <p>You're only a couple clicks away from setting up your net worth tracker!</p>
  <div class="exit-modal-buttons">
    <button class="option-button exit-btn-secondary" onclick="closeExitConfirm()">Back to Form</button>
    <button class="option-button exit-btn-primary" onclick="exitForm()">Exit</button>
  </div>
</div>

<script>
  // User ID System
  function generateUserId() {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    let result = '';
    for (let i = 0; i < 20; i++) {
      result += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return result;
  }
  
  function getOrCreateUserId() {
    let userId = localStorage.getItem('sabeid');
    if (!userId) {
      userId = generateUserId();
      localStorage.setItem('sabeid', userId);
    }
    return userId;
  }
  
  // Initialize user ID on page load
  document.addEventListener('DOMContentLoaded', function() {
    const userId = getOrCreateUserId();
    console.log('User ID:', userId);
    
    // Track page load event
    if (typeof dataLayer !== 'undefined') {
      dataLayer.push({
        'event': 'page_view',
        'page_title': 'Net Worth Calculator',
        'page_location': window.location.href,
        'user_id': userId
      });
    }
    
    // Initialize manual calculation sliders if they exist
    initializeManualCalculation();
  });
  
  let calculationMode = '';
  let assetRange = '';
  let stepOrder = ['1'];
  let currentIndex = 0;
  
  // Manual calculation data
  let manualData = {
    cash: 0,
    investments: 0,
    realEstate: 0,
    otherAssets: 0,
    mortgage: 0,
    otherDebt: 0
  };

  function setStepOrder(order) { 
    stepOrder = order; 
    updateProgress(); 
  }

  function trackFormEvent(page, step, action, value) {
    const eventName = `form_${page}_${step}_${action}_${value}`;
    
    // Google Tag Manager - Push to dataLayer
    if (typeof dataLayer !== 'undefined') {
      dataLayer.push({
        'event': 'form_interaction',
        'event_category': 'lead_form',
        'event_label': eventName,
        'form_page': page,
        'form_step': step,
        'form_action': action,
        'form_value': value,
        'user_id': getOrCreateUserId(),
        'asset_range': assetRange,
        'calculation_mode': calculationMode
      });
    }
    
    // Console logging for development
    console.log('Form Event:', eventName);
    console.log('DataLayer Event:', {
      'event': 'form_interaction',
      'event_category': 'lead_form',
      'event_label': eventName,
      'form_page': page,
      'form_step': step,
      'form_action': action,
      'form_value': value
    });
  }

  function selectCalculationMode(mode) {
    trackFormEvent('net-worth', '1', 'select', mode);
    calculationMode = mode;
    
    if (mode === 'automated') {
      // For automated mode, go to liquid net worth question
      setStepOrder(['1','2','3','4']);
      goTo('2');
    } else {
      // For manual mode, start the manual calculation flow
      setStepOrder(['1','manual-cash','manual-investments','manual-real-estate','manual-other-assets','manual-mortgage','manual-other-debt','manual-results','4']);
      goTo('manual-cash');
      initializeManualCalculation();
    }
  }

  function selectAssets(value) {
    trackFormEvent('net-worth', '2', 'select', value);
    assetRange = value;
    const highValue = ['$100k–$500k', '$500k–$1m', '$1m+'];
    const pocketsmithValue = ['$10k–$50k', '$50k–$100k'];
    const lowValue = ['<$10k'];
    
    if (highValue.includes(value)) { 
      document.getElementById('empower-recommendation').textContent = `Continue to Track Net Worth Automatically`;
      document.getElementById('empower-subtext').textContent = `Here's how you track net worth automatically - just connect a few accounts and you're good to get a full financial picture. Based on your ${assetRange} net worth, we recommend Empower's free net worth tracker.`;
      setStepOrder(['1','2','3','4']); 
      goTo('3'); 
    }
    else if (pocketsmithValue.includes(value)) { 
      document.getElementById('pocketsmith-subtext').textContent = `Here's how you track net worth automatically - just connect a few accounts and you're good to get a full financial picture. Based on your ${assetRange} net worth, we recommend Pocketsmith's powerful financial forecasting platform.`;
      setStepOrder(['1','2','3-pocketsmith','4']); 
      goTo('3-pocketsmith'); 
    }
    else if (lowValue.includes(value)) { 
      document.getElementById('monarch-subtext').textContent = `Here's how you track net worth automatically - just connect a few accounts and you're good to get a full financial picture. Based on your ${assetRange} net worth, we recommend Monarch Money's comprehensive financial management platform.`;
      setStepOrder(['1','2','3-monarch','4']); 
      goTo('3-monarch'); 
    }
    else { 
      setStepOrder(['1','2']); 
      goTo('2'); 
    }
  }

  function initializeManualCalculation() {
    // Set up slider event listeners
    const sliders = ['cash', 'investments', 'real-estate', 'other-assets', 'mortgage', 'other-debt'];
    
    sliders.forEach(type => {
      const slider = document.getElementById(`${type}-slider`);
      const valueSpan = document.getElementById(`${type}-value`);
      
      if (slider && valueSpan) {
        slider.addEventListener('input', function() {
          const value = parseInt(this.value);
          valueSpan.textContent = value.toLocaleString();
          
          // Update manual data
          const key = type.replace('-', '');
          manualData[key] = value;
          
          // Update running tally
          updateRunningTally();
        });
      }
    });
  }

  function updateRunningTally() {
    const totalAssets = manualData.cash + manualData.investments + manualData.realEstate + manualData.otherAssets;
    const totalLiabilities = manualData.mortgage + manualData.otherDebt;
    const netWorth = totalAssets - totalLiabilities;
    
    // Update all tally displays
    const tallyElements = document.querySelectorAll('#total-assets');
    const liabilityElements = document.querySelectorAll('#total-liabilities');
    const netWorthElements = document.querySelectorAll('#net-worth-total');
    
    tallyElements.forEach(el => el.textContent = totalAssets.toLocaleString());
    liabilityElements.forEach(el => el.textContent = totalLiabilities.toLocaleString());
    netWorthElements.forEach(el => el.textContent = netWorth.toLocaleString());
  }

  function nextManualStep(currentStep) {
    // Save current step data
    const slider = document.getElementById(`${currentStep}-slider`);
    if (slider) {
      const value = parseInt(slider.value);
      const key = currentStep.replace('-', '');
      manualData[key] = value;
    }
    
    // Determine next step
    const manualSteps = ['manual-cash', 'manual-investments', 'manual-real-estate', 'manual-other-assets', 'manual-mortgage', 'manual-other-debt'];
    const currentIndex = manualSteps.indexOf(`manual-${currentStep}`);
    const nextStep = manualSteps[currentIndex + 1];
    
    if (nextStep) {
      goTo(nextStep);
    } else {
      // We're done with manual calculation, show results
      goTo('manual-results');
    }
  }

  function updateFinalResults() {
    const totalAssets = manualData.cash + manualData.investments + manualData.realEstate + manualData.otherAssets;
    const totalLiabilities = manualData.mortgage + manualData.otherDebt;
    const netWorth = totalAssets - totalLiabilities;
    
    document.getElementById('final-assets').textContent = `$${totalAssets.toLocaleString()}`;
    document.getElementById('final-liabilities').textContent = `$${totalLiabilities.toLocaleString()}`;
    document.getElementById('final-net-worth').textContent = `$${netWorth.toLocaleString()}`;
  }

  function showManualRecommendation() {
    const liquidAssets = manualData.cash + manualData.investments;
    
    // Get the recommendation elements
    const logoElement = document.getElementById('manual-recommendation-logo');
    const buttonElement = document.getElementById('manual-recommendation-button');
    
    // Determine recommendation based on liquid assets (cash + investments) only
    if (liquidAssets >= 100000) {
      // Show Empower recommendation
      logoElement.querySelector('img').src = '/assets/empower-logo.svg';
      logoElement.querySelector('img').alt = 'Empower Logo';
      buttonElement.textContent = 'Track Net Worth Automatically w/ Empower';
      buttonElement.onclick = redirectToEmpowerManual;
    } else {
      // Show Pocketsmith recommendation
      logoElement.querySelector('img').src = '/assets/pocketsmith-logo.svg';
      logoElement.querySelector('img').alt = 'Pocketsmith Logo';
      buttonElement.textContent = 'Track Net Worth Automatically w/ Pocketsmith';
      buttonElement.onclick = redirectToPocketsmithManual;
    }
  }

  function goTo(id) { 
    toggle(currentIndex, true); 
    const newIndex = stepOrder.indexOf(id); 
    currentIndex = newIndex === -1 ? currentIndex : newIndex; 
    toggle(currentIndex, false); 
    syncHash(stepOrder[currentIndex]); 
    updateProgress(); 
    
    // Update step 4 text with asset range if available
    if (id === '4' && assetRange) {
      const step4Subtext = document.getElementById('step4-subtext');
      if (step4Subtext) {
        step4Subtext.textContent = `We'll send you custom strategies to grow your ${assetRange} net worth faster, plus exclusive access to our best money-saving tools.`;
      }
    }
    
    // Handle manual results step
    if (id === 'manual-results') {
      updateFinalResults();
      showManualRecommendation();
    }
  }

  function goPrev() { if (currentIndex === 0) return; history.back(); }

  function toggle(index, hide) { const el = document.getElementById(`step-${stepOrder[index]}`); if (!el) return; el.classList[hide ? 'add' : 'remove']('hidden'); }

  function updateProgress() {
    const total = stepOrder.length;
    const at = currentIndex + 1;
    document.getElementById('progress-fill').style.width = `${(at / Math.max(total,3)) * 100}%`;
    const prevLink = document.getElementById('previous-link');
    if (currentIndex > 0) prevLink.classList.remove('hidden'); else prevLink.classList.add('hidden');
    
    // Track progress updates
    trackFormEvent('net-worth', 'progress', 'update', `${at}/${total}`);
  }

  function getGclid() {
    // Check URL parameters first
    const urlParams = new URLSearchParams(window.location.search);
    let gclid = urlParams.get('gclid');
    
    // If gclid found in URL, save it as a 90-day cookie
    if (gclid) {
      const expiryDate = new Date();
      expiryDate.setDate(expiryDate.getDate() + 90);
      document.cookie = `gclid=${gclid}; expires=${expiryDate.toUTCString()}; path=/; SameSite=Lax`;
    }
    
    // If not in URL, check cookies
    if (!gclid) {
      const cookies = document.cookie.split(';');
      for (let cookie of cookies) {
        const [name, value] = cookie.trim().split('=');
        if (name === 'gclid') {
          gclid = value;
          break;
        }
      }
    }
    
    return gclid || '';
  }

  function redirectToEmpower() {
    trackFormEvent('net-worth', '3', 'click', 'continue');
    
    // Track the redirect event
    if (typeof dataLayer !== 'undefined') {
      dataLayer.push({
        'event': 'redirect_click',
        'redirect_destination': 'empower',
        'user_id': getOrCreateUserId(),
        'asset_range': assetRange,
        'calculation_mode': calculationMode
      });
    }
    
    // Get user ID and gclid
    const sabeid = getOrCreateUserId();
    const gclid = getGclid();
    
    // Build the URL with parameters
    const baseUrl = 'https://track.flexlinkspro.com/g.ashx?foid=156074.13439.1058727&trid=1368848.157618&foc=16&fot=9999&fos=6';
    const url = `${baseUrl}&fobs=${sabeid}&fobs2=${gclid}`;
    
    window.open(url, '_blank');
    document.title = 'Level Up! Add Your Information to Advance';
    goTo('4');
  }

  function redirectToMonarch() {
    trackFormEvent('net-worth', '3-monarch', 'click', 'continue');
    
    // Track the redirect event
    if (typeof dataLayer !== 'undefined') {
      dataLayer.push({
        'event': 'redirect_click',
        'redirect_destination': 'monarch',
        'user_id': getOrCreateUserId(),
        'asset_range': assetRange,
        'calculation_mode': calculationMode
      });
    }
    
    // Get user ID and gclid
    const sabeid = getOrCreateUserId();
    const gclid = getGclid();
    
    // Build the URL with parameters for Monarch Money
    const baseUrl = 'https://www.monarchmoney.com/landing/affiliate-manage-finances';
    const url = `${baseUrl}?fobs=${sabeid}&fobs2=${gclid}`;
    
    window.open(url, '_blank');
    document.title = 'Level Up! Add Your Information to Advance';
    goTo('4');
  }

  function redirectToPocketsmith() {
    trackFormEvent('net-worth', '3-pocketsmith', 'click', 'continue');
    
    // Track the redirect event
    if (typeof dataLayer !== 'undefined') {
      dataLayer.push({
        'event': 'redirect_click',
        'redirect_destination': 'pocketsmith',
        'user_id': getOrCreateUserId(),
        'asset_range': assetRange,
        'calculation_mode': calculationMode
      });
    }
    
    // Get user ID and gclid
    const sabeid = getOrCreateUserId();
    const gclid = getGclid();
    
    // Build the URL with parameters for Pocketsmith (placeholder for now)
    const baseUrl = 'https://www.pocketsmith.com';
    const url = `${baseUrl}?fobs=${sabeid}&fobs2=${gclid}`;
    
    window.open(url, '_blank');
    document.title = 'Level Up! Add Your Information to Advance';
    goTo('4');
  }

  function redirectToEmpowerManual() {
    trackFormEvent('net-worth', 'manual-empower', 'click', 'continue');
    
    // Track the redirect event
    if (typeof dataLayer !== 'undefined') {
      dataLayer.push({
        'event': 'redirect_click',
        'redirect_destination': 'empower',
        'user_id': getOrCreateUserId(),
        'asset_range': 'manual_calculation',
        'calculation_mode': calculationMode
      });
    }
    
    // Get user ID and gclid
    const sabeid = getOrCreateUserId();
    const gclid = getGclid();
    
    // Build the URL with parameters
    const baseUrl = 'https://track.flexlinkspro.com/g.ashx?foid=156074.13439.1058727&trid=1368848.157618&foc=16&fot=9999&fos=6';
    const url = `${baseUrl}&fobs=${sabeid}&fobs2=${gclid}`;
    
    window.open(url, '_blank');
    document.title = 'Level Up! Add Your Information to Advance';
    goTo('4');
  }

  function redirectToPocketsmithManual() {
    trackFormEvent('net-worth', 'manual-pocketsmith', 'click', 'continue');
    
    // Track the redirect event
    if (typeof dataLayer !== 'undefined') {
      dataLayer.push({
        'event': 'redirect_click',
        'redirect_destination': 'pocketsmith',
        'user_id': getOrCreateUserId(),
        'asset_range': 'manual_calculation',
        'calculation_mode': calculationMode
      });
    }
    
    // Get user ID and gclid
    const sabeid = getOrCreateUserId();
    const gclid = getGclid();
    
    // Build the URL with parameters for Pocketsmith (placeholder for now)
    const baseUrl = 'https://www.pocketsmith.com';
    const url = `${baseUrl}?fobs=${sabeid}&fobs2=${gclid}`;
    
    window.open(url, '_blank');
    document.title = 'Level Up! Add Your Information to Advance';
    goTo('4');
  }

  function redirectFromManualResults() {
    // This function is called by the button onclick, but the actual redirect
    // is handled by the specific redirect functions assigned in showManualRecommendation
    // This is just a fallback in case the onclick assignment fails
    const liquidAssets = manualData.cash + manualData.investments;
    if (liquidAssets >= 100000) {
      redirectToEmpowerManual();
    } else {
      redirectToPocketsmithManual();
    }
  }

  function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  }

  function submitEmail() {
    const emailInput = document.querySelector('.email-input');
    const email = emailInput.value.trim();
    
    if (isValidEmail(email)) {
      trackFormEvent('net-worth', '4', 'submit', email);
      
      // Track email submission event
      if (typeof dataLayer !== 'undefined') {
        dataLayer.push({
          'event': 'email_submit',
          'email_provided': 'yes',
          'user_id': getOrCreateUserId(),
          'asset_range': assetRange,
          'calculation_mode': calculationMode
        });
      }
      
      // Store user preferences
      localStorage.setItem('savebest_user_preferences', JSON.stringify({
        asset_range: assetRange,
        calculation_mode: calculationMode,
        email: email
      }));
      // Here you would typically send the data to your backend
      alert('Thank you! We\'ll be in touch soon.');
    } else {
      trackFormEvent('net-worth', '4', 'invalid_email', email);
      
      // Track invalid email event
      if (typeof dataLayer !== 'undefined') {
        dataLayer.push({
          'event': 'email_submit',
          'email_provided': 'no',
          'email_error': 'invalid_format',
          'user_id': getOrCreateUserId(),
          'asset_range': assetRange,
          'calculation_mode': calculationMode
        });
      }
      
      alert('Please enter a valid email address.');
    }
  }

  function syncHash(stepId) { const desired = `#${stepId}`; if (location.hash !== desired) location.hash = desired; }

  // Help tooltip functionality
  function showHelp() {
    const helpContent = getHelpContent();
    document.getElementById('help-title').textContent = helpContent.title;
    document.getElementById('help-content').textContent = helpContent.content;
    document.getElementById('overlay').style.display = 'block';
    document.getElementById('help-tooltip').style.display = 'block';
  }

  function closeHelp() {
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('help-tooltip').style.display = 'none';
  }

  function showExitConfirm() {
    document.getElementById('overlay').style.display = 'block';
    document.getElementById('exit-confirm-modal').style.display = 'block';
  }

  function closeExitConfirm() {
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('exit-confirm-modal').style.display = 'none';
  }

  function exitForm() {
    // Track exit event
    trackFormEvent('net-worth', 'exit', 'confirm', 'user_exit');
    
    if (typeof dataLayer !== 'undefined') {
      dataLayer.push({
        'event': 'form_exit',
        'exit_reason': 'user_confirmed',
        'user_id': getOrCreateUserId(),
        'asset_range': assetRange,
        'calculation_mode': calculationMode
      });
    }
    
    // Redirect to exit page with financial tool options
    window.location.href = '/lp/nw-exit.html';
  }

  function getHelpContent() {
    const currentStep = stepOrder[currentIndex];
    const helpData = {
      '1': {
        title: "Why are we asking about calculation mode?",
        content: "We want to give you the best experience for calculating your net worth. Automated mode connects your accounts directly and tracks everything automatically over time. Manual mode lets you input your assets and liabilities step by step, giving you more control and privacy. Choose what works best for you!"
      },
      '2': {
        title: "Why are we asking about your net worth?",
        content: "Your liquid net worth helps us recommend the most suitable financial tools for your situation. Different wealth levels have different needs - someone with $10k needs different advice than someone with $500k. This ensures you get personalized recommendations that actually work for your financial stage."
      },
      '3': {
        title: "Why are we recommending Empower?",
        content: "Based on your financial situation, Empower offers the best combination of features, ease of use, and value. It's free forever, syncs with all your accounts automatically, and provides professional-grade insights. We've tested dozens of tools and found this works best for users in your financial range."
      },
      '3-monarch': {
        title: "Why are we recommending Monarch Money?",
        content: "For users with under $10k net worth, Monarch Money provides the perfect balance of comprehensive features and ease of use. It's designed to help you build better financial habits and grow your wealth systematically. The platform offers beautiful insights and expert guidance tailored to your financial stage."
      },
      '3-pocketsmith': {
        title: "Why are we recommending Pocketsmith?",
        content: "For users with $10k-$100k net worth, Pocketsmith offers advanced financial forecasting and cash flow planning that's perfect for your wealth-building stage. It helps you project your financial future, plan for major expenses, and track progress toward your goals. The platform's forecasting capabilities are unmatched for users looking to grow their wealth systematically."
      },
      '4': {
        title: "Why are we asking for your email?",
        content: "We want to send you personalized strategies to grow your wealth faster. Based on your net worth and current situation, we'll share specific tips, tools, and opportunities that are most relevant to you. You can unsubscribe anytime, and we'll never spam you."
      },
      'manual-cash': {
        title: "Why are we asking about cash?",
        content: "Cash includes all your liquid assets - checking accounts, savings accounts, and physical cash. This is the foundation of your financial picture and helps us understand your immediate financial position."
      },
      'manual-investments': {
        title: "Why are we asking about investments?",
        content: "Investments include retirement accounts (401k, IRA), brokerage accounts, and other investment vehicles. These are often your largest assets and key to long-term wealth building."
      },
      'manual-real-estate': {
        title: "Why are we asking about real estate?",
        content: "Real estate includes your home, rental properties, and other real estate assets. This is typically one of the largest components of net worth for most people."
      },
      'manual-other-assets': {
        title: "Why are we asking about other assets?",
        content: "Other assets include vehicles, jewelry, collectibles, business interests, and other valuable items. These can add up significantly to your total net worth."
      },
      'manual-mortgage': {
        title: "Why are we asking about mortgage debt?",
        content: "Mortgage debt is typically the largest liability for most people. We need to subtract this from your real estate value to get an accurate net worth calculation."
      },
      'manual-other-debt': {
        title: "Why are we asking about other debt?",
        content: "Other debt includes credit cards, car loans, student loans, personal loans, and other debts. All liabilities need to be subtracted from your assets to calculate true net worth."
      },
             'manual-results': {
         title: "Understanding your net worth calculation",
         content: "Your net worth is calculated as Total Assets minus Total Liabilities. This gives you a complete picture of your financial position. A positive net worth means you own more than you owe, while a negative net worth means you owe more than you own."
       }
    };
    return helpData[currentStep] || {
      title: "Help",
      content: "This is the help section for the current step."
    };
  }

  // Close tooltip when clicking overlay
  document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('overlay').addEventListener('click', function() {
      closeHelp();
      closeExitConfirm();
    });
  });

  window.addEventListener('hashchange', () => {
    const id = location.hash.replace('#','');
    const idx = stepOrder.indexOf(id);
    if (idx !== -1 && idx !== currentIndex) { toggle(currentIndex, true); currentIndex = idx; toggle(currentIndex, false); updateProgress(); }
  });

  if (!location.hash) syncHash(stepOrder[currentIndex]); else {
    const id = location.hash.replace('#','');
    if (stepOrder.includes(id)) { toggle(currentIndex, true); currentIndex = stepOrder.indexOf(id); toggle(currentIndex, false); }
    else syncHash(stepOrder[currentIndex]);
  }
  updateProgress();
</script>

</body>
</html>
